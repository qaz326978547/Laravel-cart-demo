<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use App\Models\Product;
//Validator
use Illuminate\Support\Facades\Validator;
use Illuminate\Support\Facades\DB;
class ProductController extends Controller
{
    //
    public function getProducts()
    {
        DB::enableQueryLog();

        $products = Product::all();
        $log = DB::getQueryLog();
        dd($log);
        return response()->json($products);
    }

    public function getProduct($id)
    {
        $product = Product::find($id);
        return response()->json($product);
    }

    public function createProduct(Request $request)
    {

        try{
           Validator::make($request->all(), [
            'name' => 'required',
            'price' => 'required | integer',
            'description' => 'required',
            'quantity' => 'required | integer',
            ])->validate();
            $form = $request->all();
    
            $product = Product::create($form);
            return response()->json($product);
        }
        catch (\Illuminate\Validation\ValidationException $e) {
            $errors = $e->validator->errors()->getMessages();
            return response()->json($errors, 400);
        }
    }

    public function updateProduct(Request $request)
    {


























































































































































































































































































































































































































































































































































































































































































































































        $user = $request->user();
        if($user->role != 'admin'){
            return response()->json(['error'=>'權限不足'], 403);
        }
        Validator::make($request->all(), [
            'productId' => 'required | integer',
            'name' => 'string',
            'price' => 'integer',
            'description' => 'string',
            'quantity' => 'integer',
            ])->validate();

        $form = $request->all();
        $product = Product::find($form['productId']);
        $product->update($form);
        return response()->json($product);
    }
}
